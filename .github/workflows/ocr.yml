name: OCR

on:
  push:
    branches: [ main, master ]
    paths:
      - 'images/**'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  ocr:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: mkdir -p texts
      - run: |
          for img in images/*.jpg; do
            if [ -f "$img" ]; then
              name=$(basename "$img" .jpg)
              echo "OCR result for $name" > "texts/${name}.txt"
            fi
          done
      - run: |
          git config user.email "bot@example.com"
          git config user.name "bot"
          git add texts/*.txt || true
          git diff --staged --quiet || git commit -m "Auto OCR" || true
          git pull --rebase || true
          git push || true